!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("react"),require("dijit/registry"),require("mendix/lang"),require("dojo/topic"));else if("function"==typeof define&&define.amd)define(["react","dijit/registry","mendix/lang","dojo/topic"],e);else{var r="object"==typeof exports?e(require("react"),require("dijit/registry"),require("mendix/lang"),require("dojo/topic")):e(t.react,t["dijit/registry"],t["mendix/lang"],t["dojo/topic"]);for(var i in r)("object"==typeof exports?exports:t)[i]=r[i]}}(window,function(t,e,r,i){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=15)}({0:function(e,r){e.exports=t},1:function(t,e,r){var i;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){"use strict";var r={}.hasOwnProperty;function n(){for(var t=[],e=0;e<arguments.length;e++){var i=arguments[e];if(i){var o=typeof i;if("string"===o||"number"===o)t.push(i);else if(Array.isArray(i)&&i.length){var s=n.apply(null,i);s&&t.push(s)}else if("object"===o)for(var a in i)r.call(i,a)&&i[a]&&t.push(a)}}return t.join(" ")}void 0!==t&&t.exports?(n.default=n,t.exports=n):void 0===(i=function(){return n}.apply(e,[]))||(t.exports=i)}()},15:function(t,e,r){var i,n,o=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();i=[r,e,r(0),r(1),r(5),r(8),r(6),r(7),r(2),r(16),r(3),r(42)],void 0===(n=function(t,e,r,i,n,s,a,u,c,l,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(t){function e(e){var r=t.call(this,e)||this;return r.state={defaultOption:r.getDefaultOption(),listViewAvailable:!1},n.delay(r.connectToListView.bind(r),r.checkListViewAvailable.bind(r),20),r.updateSort=r.updateSort.bind(r),r.subScribeToWidgetChanges=r.subScribeToWidgetChanges.bind(r),r.publishWidgetChanges=r.publishWidgetChanges.bind(r),r}return o(e,t),e.prototype.render=function(){var t=this;return r.createElement("div",{className:i("widget-drop-down-sort",this.props.class),ref:function(e){return t.widgetDOM=e},style:c.SharedUtils.parseStyle(this.props.style)},r.createElement(a.Alert,{bootstrapStyle:"danger",className:"widget-drop-down-sort-alert"},this.state.alertMessage),this.renderDropDown())},e.prototype.componentDidUpdate=function(t,e){if(this.state.listViewAvailable&&!e.listViewAvailable){var r=this.props.sortAttributes.filter(function(t){return t.defaultSelected})[0];r&&this.updateSort(r.name,r.sort)}},e.prototype.checkListViewAvailable=function(){return!!p.SharedContainerUtils.findTargetListView(this.widgetDOM.parentElement,this.props.entity)},e.prototype.renderDropDown=function(){return this.state.alertMessage?null:r.createElement(l.DropDown,{friendlyId:this.props.friendlyId,onDropDownChangeAction:this.updateSort,publishedSortAttribute:this.state.publishedSortAttribute,publishedSortOrder:this.state.publishedSortOrder,publishedSortWidgetFriendlyId:this.state.publishedSortWidgetFriendlyId,sortAttributes:this.props.sortAttributes,style:c.SharedUtils.parseStyle(this.props.style)})},e.prototype.getDefaultOption=function(){return this.props.sortAttributes.filter(function(t){return t.defaultSelected})[0]},e.prototype.connectToListView=function(){var t,e="";try{this.dataSourceHelper=u.DataSourceHelper.getInstance(this.widgetDOM.parentElement,this.props.entity),t=this.dataSourceHelper.getListView()}catch(t){e=t.message}t&&!e&&(this.subscriptionTopic=t.friendlyId+"_sortUpdate",this.subScribeToWidgetChanges(),this.state.defaultOption||u.DataSourceHelper.showContent(t.domNode)),this.setState({alertMessage:e,listViewAvailable:!!t,targetListView:t})},e.prototype.updateSort=function(t,e){this.state.targetListView&&this.dataSourceHelper&&(this.dataSourceHelper.setSorting(this.props.friendlyId,[t,e]),this.publishWidgetChanges(t,e))},e.prototype.subScribeToWidgetChanges=function(){var t=this;s.subscribe(this.subscriptionTopic,function(e){t.setState({publishedSortAttribute:e[0],publishedSortOrder:e[1],publishedSortWidgetFriendlyId:e[2]})})},e.prototype.publishWidgetChanges=function(t,e){s.publish(this.subscriptionTopic,[t,e,this.props.friendlyId])},e}(r.Component);e.default=d}.apply(e,i))||(t.exports=n)},16:function(t,e,r){var i,n,o=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();i=[r,e,r(0)],void 0===(n=function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(e){var r=t.call(this,e)||this;return r.options=[],r.state={value:r.getDefaultValue(r.props)},r.handleChange=r.handleChange.bind(r),r.renderOptions=r.renderOptions.bind(r),r.callOnChangeAction=r.callOnChangeAction.bind(r),r}return o(e,t),e.prototype.componentWillReceiveProps=function(t){var e=this.getDefaultValue(t);this.state.value!==e&&this.setState({value:e}),t.publishedSortAttribute&&t.publishedSortOrder&&this.props.friendlyId!==t.publishedSortWidgetFriendlyId&&this.setState({value:""})},e.prototype.render=function(){var t=this;return r.createElement("select",{className:"form-control",onChange:this.handleChange,ref:function(e){return t.selectorDomNode=e},value:this.state.value},this.renderOptions())},e.prototype.componentDidUpdate=function(t,e){""===this.state.value&&(this.selectorDomNode.selectedIndex=-1)},e.prototype.getDefaultValue=function(t){this.options=this.createOptionProps(t.sortAttributes);var e=this.options.filter(function(t){return t.defaultSelected})[0];return e?e.value:""},e.prototype.renderOptions=function(){return this.options.map(function(t){var e=t.caption,i=t.value,n={className:"",key:i,label:e,value:i};return r.createElement("option",n,e)})},e.prototype.handleChange=function(t){var e=t.currentTarget.value;this.setState({value:e}),this.callOnChangeAction(e)},e.prototype.callOnChangeAction=function(t){var e=this.options.filter(function(e){return e.value===t})[0];e&&this.props.onDropDownChangeAction&&this.props.onDropDownChangeAction(e.name,e.sort)},e.prototype.createOptionProps=function(t){return t.map(function(t,e){var r=t.name;return{name:r,caption:t.caption,defaultSelected:t.defaultSelected,sort:t.sort,value:r+"-"+e}})},e}(r.Component);e.DropDown=i}.apply(e,i))||(t.exports=n)},2:function(t,e,r){var i;void 0===(i=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.paginationTopicSuffix="_paginationUpdate";var r=function(){function t(){}return t.parseStyle=function(t){void 0===t&&(t="");try{return t.split(";").reduce(function(t,e){var r=e.split(":");2===r.length&&(t[r[0].trim().replace(/(-.)/g,function(t){return t[1].toUpperCase()})]=r[1].trim());return t},{})}catch(e){window.console.log("Failed to parse style",t,e)}return{}},t.validateCompatibility=function(t){var e=t.listViewEntity,r=t.targetListView,i=r&&r.datasource&&r.datasource.type;if(!r){var n="This widget is unable to find a list view ";return n+=e?"with the supplied entity '"+e+"'":"to connect"}return i&&"database"!==i&&"xpath"!==i?"This widget is only compatible with list view data source type 'Database' and 'XPath'":r&&r._datasource&&r._entity&&r.update?r._entity&&e!==r._entity?'The supplied entity "'+t.listViewEntity+'" does not belong to list view data source':"":"This widget version is not compatible with this Mendix version"},t.findTargetNode=function(t){for(var e=null;!e&&t&&!((e=t.querySelectorAll(".mx-listview")[0])||t.isEqualNode(document)||!t.classList||t.classList.contains("mx-incubator")||t.classList.contains("mx-offscreen"));)t=t.parentNode;return e},t}();e.SharedUtils=r}.apply(e,[r,e]))||(t.exports=i)},3:function(t,e,r){var i,n;i=[r,e,r(4)],void 0===(n=function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.findTargetListView=function(t,e){for(var i;t;){var n=t.querySelectorAll(".mx-listview");if(t.isEqualNode(document)||!t.classList||t.classList.contains("mx-incubator")||t.classList.contains("mx-offscreen"))break;for(var o=0;o<n.length;o++){if((i=r.byNode(n.item(o)))&&!e)return i;if(i&&i._entity===e)return i}t=t.parentNode}return i},t}();e.SharedContainerUtils=i}.apply(e,i))||(t.exports=n)},31:function(t,e){},4:function(t,r){t.exports=e},42:function(t,e){},5:function(t,e){t.exports=r},6:function(t,e,r){var i,n;i=[r,e,r(0),r(1)],void 0===(n=function(t,e,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Alert=function(t){var e=t.bootstrapStyle,n=t.className,o=t.children;return o?r.createElement("div",{className:i("alert alert-"+e,n)},o):null},e.Alert.displayName="Alert",e.Alert.defaultProps={bootstrapStyle:"danger"}}.apply(e,i))||(t.exports=n)},7:function(t,e,r){var i,n;i=[r,e,r(2),r(3),r(31)],void 0===(n=function(t,e,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.initialLoad=!0,this.delay=50,this.store={constraints:{_none:{}},sorting:{}},this.updateInProgress=!1,this.requiresUpdate=!1,this.widget=t}return t.getInstance=function(e,n){var o=i.SharedContainerUtils.findTargetListView(e,n),s=r.SharedUtils.validateCompatibility({listViewEntity:n,targetListView:o});if(!s)return o.__customWidgetDataSourceHelper||(o.__customWidgetDataSourceHelper=new t(o)),o.__customWidgetDataSourceHelper.initialLoad=!0,this.hideContent(o.domNode),o.__customWidgetDataSourceHelper;throw new Error(s)},t.prototype.setSorting=function(t,e){this.store.sorting={},this.store.sorting[t]=e,this.registerUpdate()},t.prototype.setConstraint=function(t,e,r){var i;void 0===r&&(r="_none");var n=r.trim()||"_none";this.store.constraints[n]?this.store.constraints[n][t]=e:this.store.constraints[n]=((i={})[t]=e,i),this.registerUpdate()},t.prototype.getListView=function(){return this.widget},t.prototype.registerUpdate=function(){var t=this;this.timeoutHandle&&window.clearTimeout(this.timeoutHandle),this.updateInProgress?this.requiresUpdate=!0:this.timeoutHandle=window.setTimeout(function(){t.updateInProgress=!0,t.iterativeUpdateDataSource()},this.delay)},t.prototype.iterativeUpdateDataSource=function(){var t=this;this.updateDataSource(function(){t.requiresUpdate?(t.requiresUpdate=!1,t.iterativeUpdateDataSource()):t.updateInProgress=!1})},t.prototype.updateDataSource=function(t){var e=this,r=[],i=Object.keys(this.store.sorting).map(function(t){return e.store.sorting[t]}).filter(function(t){return t[0]&&t[1]});if(i.length||this.widget._datasource._sorting.forEach(function(t){return i.push(t)}),window.mx.isOffline()){for(var n=Object.keys(this.store.constraints._none).map(function(t){return e.store.constraints._none[t]}),o=n.filter(function(t){return t.value}),s=n.filter(function(t){return t.operator}),a=[],u=0,c=Object.keys(this.store.constraints).filter(function(t){return"_none"!==t});u<c.length;u++){for(var l=c[u],p=[],d=0,f=Object.keys(this.store.constraints[l]);d<f.length;d++){var h=f[d],g=this.store.constraints[l][h];g&&g.value&&p.push(g)}p.length&&a.push({constraints:p,operator:"or"})}r=o.concat(s,a)}else{r=(o=Object.keys(this.store.constraints._none).map(function(t){return e.store.constraints._none[t]}).join(""))+(a=Object.keys(this.store.constraints).filter(function(t){return"_none"!==t}).map(function(t){return"["+Object.keys(e.store.constraints[t]).map(function(r){return e.store.constraints[t][r]}).filter(function(t){return t}).map(function(t){return t.trim().substr(1,t.trim().length-2)}).join(" or ")+"]"}).join("").replace(/\[]/g,""))}this.widget._datasource._constraints=r,this.widget._datasource[window.mx.isOffline()?"_sort":"_sorting"]=i,this.initialLoad||this.showLoader(),this.widget.update(null,function(){e.hideLoader(),e.initialLoad=!1,t()})},t.prototype.showLoader=function(){this.widget.domNode.classList.add("widget-data-source-helper-loading")},t.hideContent=function(t){t&&t.classList.add("widget-data-source-helper-initial-loading")},t.showContent=function(t){t&&t.classList.remove("widget-data-source-helper-initial-loading")},t.prototype.hideLoader=function(){this.widget.domNode.classList.remove("widget-data-source-helper-loading"),t.showContent(this.widget.domNode)},t}();e.DataSourceHelper=n}.apply(e,i))||(t.exports=n)},8:function(t,e){t.exports=i}})});